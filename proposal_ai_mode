# File Tinder AI Mode â€” Design Proposal (v2)

## Core Concept

AI Mode is a **third mode that works in tandem with Basic and Advanced**. It looks like Advanced Mode at its core â€” the mind map grid and quick access bar are the stars â€” but an AI engine drives the sorting, either fully (Auto) or as a smart assistant (Semi).

The user clicks an **AI button** that opens a configuration dialog. The AI then analyzes every file individually using taxonomy rules, contextualizing each file precisely (e.g., "Serum" isn't just a `.dll` â€” it's a VST plugin, specifically a generator synth). After analysis, the user either reviews AI decisions on the review screen (Auto) or gets AI-highlighted folder suggestions per file in the Advanced-style view (Semi).

---

## How It Differs from Basic & Advanced

| Aspect | Basic Mode | Advanced Mode | AI Mode |
|--------|-----------|---------------|---------|
| **Who decides** | You, one file at a time | You, with folder tree visible | AI decides (Auto) or suggests (Semi) |
| **UI style** | Swipe cards | Mind map + quick access | Same as Advanced, plus AI setup dialog |
| **Primary action** | Swipe: Keep/Delete/Skip | Click folder to assign | Auto: review AI plan / Semi: pick from highlighted folders |
| **Intelligence** | None | User-driven | Taxonomy-aware AI with contextual understanding |
| **Best for** | Simple cleanup | Complex folder structures | Large folders, precision sorting, domain-specific organization |

---

## The AI Setup Dialog

When the user clicks the **ğŸ¤– AI** button in AI mode, a configuration dialog appears:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ğŸ¤– AI Sorting Setup                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€ AI Provider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Provider: [OpenAI          â–¼]                         â”‚  â”‚
â”‚  â”‚  API Key:  [sk-â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]                 â”‚  â”‚
â”‚  â”‚  Endpoint: [https://api.openai.com/v1/chat/completions]â”‚  â”‚
â”‚  â”‚  Model:    [gpt-4o-mini     â–¼]     (user picks always) â”‚  â”‚
â”‚  â”‚  Rate:     [60] req/min                                â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  Providers: OpenAI | Anthropic | Gemini | Mistral |    â”‚  â”‚
â”‚  â”‚  Groq | OpenRouter | Ollama (Local) | LM Studio |     â”‚  â”‚
â”‚  â”‚  Custom endpoint                                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  [Smart rate limiting: auto-adjusts for paid vs free]  â”‚  â”‚
â”‚  â”‚  [Keys stored locally across sessions]                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Sorting Mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â—‹ Auto â€” AI sorts all files â†’ review screen           â”‚  â”‚
â”‚  â”‚  â— Semi â€” AI suggests [3 â–¼] folders per file (2-5)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Category Handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [Keep existing categories           â–¼]                â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â€¢ Keep existing: sort into your current folders       â”‚  â”‚
â”‚  â”‚  â€¢ Generate new: replace with AI-created categories    â”‚  â”‚
â”‚  â”‚  â€¢ Synthesize new: blend your intent + AI analysis     â”‚  â”‚
â”‚  â”‚  â€¢ Keep + Generate: keep current, add new ones too     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Category Depth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Subcategory depth: [2 â–¼] levels (1-3)                 â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  Depth 1: Images/                                      â”‚  â”‚
â”‚  â”‚  Depth 2: Images/Vacation/                             â”‚  â”‚
â”‚  â”‚  Depth 3: Images/Vacation/Beach/                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ What is this folder for? (optional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ This is my music production folder. I want       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ plugins sorted by type (generators vs effects),  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ samples by instrument, and projects by client.   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ Cost estimate: ~$0.04 for 200 files (gpt-4o-mini)       â”‚
â”‚  (shown only for paid API providers)                         â”‚
â”‚                                                              â”‚
â”‚                              [Cancel]  [OK â€” Start Sorting]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Setup Dialog Fields

1. **AI Provider**: Dropdown with presets (OpenAI, Anthropic, Google Gemini, Mistral, Groq, OpenRouter, Ollama, LM Studio, Custom). Selecting a preset auto-fills endpoint, default model, and rate limits. Keys are stored locally in the DB and persist across sessions.

2. **Model selector**: Always visible â€” user picks the specific model at all times. Pre-populated with sensible defaults per provider but fully editable.

3. **Smart rate limiting**: Auto-detects paid vs free tiers. Paid APIs get higher default RPM; free/local get conservative limits. User can always override.

4. **Mode â€” Auto vs Semi**:
   - **Auto**: AI assigns every file to a folder. User goes straight to the review screen. The review screen shows an "AI" label in the mode column, and destinations are editable like Advanced mode decisions.
   - **Semi**: AI returns the top N best-match folders per file (N = 2 to 5, user picks via spinner). In the main view, the selected file's N suggested folders **light up** in the mind map grid AND appear at the top of the quick access bar. User clicks whichever one to assign. It's semi-automated Advanced mode.

5. **Categories**:
   - **Keep existing**: AI sorts files into the folder tree that already exists.
   - **Generate new**: AI creates entirely new category folders (in the source folder root, up to the chosen depth), replacing existing ones.
   - **Synthesize new**: AI analyzes the existing folder structure's *intent* and creates improved categories that blend that intent with fresh file analysis.
   - **Keep + Generate**: Keeps existing folders and adds new AI-generated ones alongside them.

6. **Category Depth** (1-3 levels): Controls how deep the AI creates subcategories. Depth 1 = flat (Images/), Depth 2 = one level of sub (Images/Vacation/), Depth 3 = two levels of sub (Images/Vacation/Beach/).

7. **Folder Purpose** (optional): Free-text prompt where the user describes the folder's purpose. This contextualizes the AI's sorting â€” "music production folder" produces very different categories than "downloads folder."

8. **Cost estimate**: Shown **only for paid APIs**. Calculates approximate token cost based on file count and model pricing. Warns user before they proceed.

---

## Auto Mode Flow

```
User clicks AI â†’ Setup dialog â†’ OK
        â†“
   Loading screen with real-time log
   "Analyzing file 42/200: serum_installer.exe"
   "Batch 1/4 sent to API..."
   "Batch 1/4 complete â€” 50 files classified"
   ...
        â†“
   â”Œâ”€ If API fails mid-batch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Dialog: "API error after 100/200 files.       â”‚
   â”‚  [Abort] [Continue to Review with 100 files]"  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   Review screen (same as Basic/Advanced)
   - Mode column shows "AI" for AI-sorted files
   - Destination column is editable (combo dropdown like Advanced mode)
   - User can change any decision before executing
        â†“
   Execute
```

### Review Screen Integration

The review screen gains a third mode label: **"AI"** alongside "Basic" and "Advanced". AI-sorted files show "AI" in the mode column. The destination dropdown works exactly like Advanced mode â€” all grid folders are available for reassignment. This is a small but important integration point showing all three modes work together.

---

## Semi Mode Flow

```
User clicks AI â†’ Setup dialog â†’ OK
        â†“
   Loading screen (same real-time log)
        â†“
   Back to AI mode view (looks like Advanced mode)
   - File shown in info panel
   - N folders LIGHT UP in the mind map grid (highlighted borders)
   - Same N folders appear at TOP of quick access bar (styled distinctly)
   - Confidence ranking: 1st suggestion = brightest highlight, 2nd dimmer, etc.
        â†“
   User clicks any folder (highlighted or not) to assign
   OR uses quick access shortcuts (1-0)
        â†“
   Next file â€” new highlights appear
        â†“
   Finish â†’ Review â†’ Execute
```

### Semi Mode Visual Behavior

- **Mind map**: The AI's N suggested folders get a distinct highlight style (e.g., glowing blue border, brighter than the normal selected style). The best match gets the strongest highlight; subsequent matches get progressively dimmer.
- **Quick access bar**: AI suggestions are inserted at the top of the list with an "AI 1:", "AI 2:", etc. prefix and a distinct background color (#1a3a5c with #3498db text). They sit above the user's pinned quick access items.
- **No restriction**: The user can click ANY folder, not just the highlighted ones. If none of the AI suggestions are right, they just click the correct folder as in normal Advanced mode.
- **Re-run AI button**: After manually sorting some files, the user can re-run AI on remaining unsorted files. Useful if early corrections help the AI learn within the session.

### "View AI Reasoning" Tooltip

Each file in semi mode has a small info icon or tooltip that shows the AI's reasoning: *"JPEG image, name pattern matches vacation photos, EXIF date within beach trip window â†’ Images/Vacation (92% confidence)"*. Builds trust and helps the user understand when the AI is right or wrong.

---

## File Investigation: Taxonomy-Aware Analysis

The AI doesn't just look at extension and MIME type. It **investigates what each file actually is** using taxonomy rules:

### What the AI Analyzes Per File

| Data Point | Example | Purpose |
|-----------|---------|---------|
| File name | `Serum_x64.dll` | Identify product/software name |
| Extension | `.dll` | File type |
| MIME type | `application/x-dosexec` | Technical classification |
| Size | 47.2 MB | Large DLL = likely a plugin |
| Name + extension + size combined | `Serum_x64.dll`, 47MB | "This is Serum, a VST synthesizer plugin (generator type)" |

### Taxonomy Precision Examples

```
File: Serum_x64.dll (47MB)
  â†’ NOT just "DLL file"
  â†’ Serum is audio software, VST plugin category, generator subtype
  â†’ Suggested folder: Plugins/Generators/

File: receipt_2024_03_15.pdf (120KB)
  â†’ NOT just "PDF document"
  â†’ Receipt (financial document), dated March 2024
  â†’ Suggested folder: Documents/Receipts/2024/

File: IMG_4521.HEIC (3.2MB)
  â†’ NOT just "Image file"
  â†’ iPhone photo, HEIC format, likely personal photo
  â†’ Suggested folder: Images/Photos/

File: jest.config.ts (2KB)
  â†’ NOT just "TypeScript file"
  â†’ Jest testing configuration, part of a JavaScript project
  â†’ Suggested folder: Code/Config/
```

The AI prompt instructs the LLM to investigate each file's identity in relation to the available categories, not just slot it by extension.

---

## Batch Processing & API Engineering

### Batching Strategy

Files are sent to the API in batches to stay within token limits:

```
Total files: 500
Batch size: ~50 files per API call (adjustable based on model context window)
Batches: 10 API calls

Per batch:
  - Send file metadata (name, ext, MIME, size) for 50 files
  - Send available folder list
  - Send category mode + depth + folder purpose
  - Receive: JSON array of assignments

Between batches:
  - Update progress: "Batch 3/10 complete â€” 150/500 files classified"
  - Check rate limit before next call
  - If user cancelled, stop and present partial results
```

### Real-Time Logging

The loading screen shows live progress for all cases:

```
[12:04:01] Starting AI analysis of 342 files...
[12:04:01] Provider: OpenAI (gpt-4o-mini) | Rate: 60 req/min
[12:04:01] Category mode: Synthesize new | Depth: 2
[12:04:02] Batch 1/7 â€” analyzing files 1-50...
[12:04:04] Batch 1/7 complete â€” 50 files classified (2.1s)
[12:04:04] Batch 2/7 â€” analyzing files 51-100...
[12:04:06] Batch 2/7 complete â€” 100 files classified (1.8s)
[12:04:06] âš ï¸ Rate limit: waiting 1.2s before next request...
[12:04:08] Batch 3/7 â€” analyzing files 101-150...
...
[12:04:18] âœ… Analysis complete â€” 342 files classified into 12 categories
[12:04:18] New folders to create: 5 | Existing folders used: 7
```

### Error Recovery

If the API fails mid-batch:

```
[12:04:12] âŒ Batch 5/7 failed: 429 Too Many Requests
           "Rate limit exceeded. Please try again in 30s."

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI analysis interrupted after 200/342 files.    â”‚
â”‚                                                  â”‚
â”‚  200 files have been classified.                 â”‚
â”‚  142 files remain unclassified.                  â”‚
â”‚                                                  â”‚
â”‚  [Abort â€” discard all results]                   â”‚
â”‚  [Continue to Review â€” with 200 classified files]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

User chooses: abort (discard everything) or proceed to review with partial results (unclassified files remain "pending").

### Local LLM Handling

For Ollama/LM Studio (local models that may be slower):

- **Streaming/progressive display**: Show results as they come in, file by file
- **No cost warning** (it's free)
- **Higher batch patience**: Allow 30+ seconds per batch before timeout
- **Progress shows ETA**: "Estimated 2 min remaining (7B model on CPU)"

### Response Parsing Robustness

LLMs don't always return clean JSON. Parsing strategy:

1. **Try JSON parse** on the full response
2. **Extract JSON array** from surrounding text (find `[` ... `]`)
3. **Line-by-line fallback**: If JSON fails, try parsing individual lines as `index|folder|reasoning`
4. **Partial success**: If 45/50 files in a batch parse correctly, accept those 45 and log the 5 failures
5. **Retry failed batches**: One automatic retry with a "please return valid JSON" reinforcement

---

## Architecture: How It Fits in the Codebase

### Class Hierarchy

```
StandaloneFileTinderDialog (Basic Mode)
    â””â”€â”€ AdvancedFileTinderDialog (Advanced Mode)
            â””â”€â”€ AiFileTinderDialog (AI Mode)    â† new
```

AI Mode inherits from `AdvancedFileTinderDialog` because it **is** Advanced Mode with AI on top. It reuses:
- Mind map grid and quick access bar (the stars of AI mode)
- File scanning, session persistence, review & execute pipeline
- Filter/sort infrastructure, database integration
- All keyboard shortcuts, folder operations, grid configs

It adds:
- The AI setup dialog (`AiSetupDialog`)
- AI analysis engine (API calls, batching, parsing)
- Semi mode folder highlighting in mind map + quick access
- Auto mode flow (analyze â†’ review screen)
- "Re-run AI" button for remaining unsorted files
- "View AI reasoning" tooltips

### New Files

```
app/include/AiFileTinderDialog.hpp    â€” AI mode dialog + setup dialog
app/lib/AiFileTinderDialog.cpp        â€” AI mode implementation
```

### New Database Table

```sql
-- AI provider settings (keys stored across sessions)
CREATE TABLE ai_providers (
    provider_name TEXT PRIMARY KEY,
    api_key TEXT,
    endpoint_url TEXT,
    model_name TEXT,
    is_local INTEGER DEFAULT 0,
    rate_limit_rpm INTEGER DEFAULT 60,
    last_used DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Integration with Launcher

```cpp
// main.cpp â€” add third mode button alongside Basic and Advanced:

auto* ai_btn = new QPushButton("ğŸ¤– AI Mode\n(AI-assisted sorting)");
connect(ai_btn, &QPushButton::clicked, this, &FileTinderLauncher::launch_ai);

// launch_ai() follows the same pattern as launch_basic / launch_advanced
// with switch_to_basic_mode and switch_to_advanced_mode signals connected
```

### Mode Switching

Full three-way switching:

```
Basic â†” Advanced â†” AI

AI â†’ Basic:    preserves all decisions, opens basic swipe view
AI â†’ Advanced: preserves all decisions, drops back to manual Advanced mode
Basic â†’ AI:    opens AI setup dialog, then analyzes remaining unsorted files
Advanced â†’ AI: opens AI setup dialog, uses current folder tree as categories
```

---

## Summary

AI Mode is Advanced Mode supercharged with an AI engine:

- **Auto mode**: "AI, sort everything. I'll review." â†’ Loading â†’ Review screen â†’ Execute
- **Semi mode**: "AI, show me the best 3 folders for each file." â†’ Advanced view with highlights â†’ User picks â†’ Execute

The mind map and quick access bar remain central. The AI doesn't replace the UI â€” it illuminates it, lighting up the right folders so the user can move faster with confidence.

Three modes, one tool:
- **Basic**: Quick cleanup â†’ *swipe, swipe, swipe*
- **Advanced**: Complex organization â†’ *click, click, click*
- **AI**: Precision sorting at scale â†’ *AI highlights, you confirm*
